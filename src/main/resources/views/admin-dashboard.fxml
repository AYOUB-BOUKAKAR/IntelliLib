<?xml version="1.0" encoding="UTF-8"?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.control.cell.PropertyValueFactory?>
<?import javafx.scene.chart.*?>

<BorderPane xmlns="http://javafx.com/javafx/21" 
            xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="com.intellilib.controllers.AdminDashboardController"
            stylesheets="@/css/style.css"
            styleClass="root">

    <!-- Sidebar -->
    <left>
        <VBox styleClass="sidebar" spacing="0">
            <!-- Sidebar Header -->
            <VBox styleClass="sidebar-header">
                <Label text="IntelliLib" styleClass="sidebar-title" />
                <Label text="Admin Dashboard" styleClass="sidebar-subtitle" />
            </VBox>
            
            <!-- Sidebar Navigation -->
            <VBox styleClass="sidebar-nav" spacing="4" VBox.vgrow="ALWAYS">
                <!-- <Button text="Dashboard" styleClass="nav-button, nav-button-active" onAction="#showDashboard" /> -->
                <Button text="Books" styleClass="nav-button" onAction="#manageBooks" />
                <Button text="Members" styleClass="nav-button" onAction="#manageMembers" />
                <Button text="Users" styleClass="nav-button" onAction="#manageUsers" />
                <Button text="Borrowings" styleClass="nav-button" onAction="#manageBorrowings" />
                <Button text="Fines" styleClass="nav-button" onAction="#manageFines" />
                <Button text="Categories" styleClass="nav-button" onAction="#manageCategories" />
                <Button text="Reports" styleClass="nav-button" onAction="#viewReports" />
                <Button text="Settings" styleClass="nav-button" onAction="#systemSettings" />
                
                <!-- Spacer -->
                <Region VBox.vgrow="ALWAYS" />
                
                <Separator styleClass="sidebar-separator" />
                <Button text="Backup Database" styleClass="nav-button" onAction="#backupDatabase" />
                <Button text="Logout" styleClass="nav-button, nav-button-logout" onAction="#logout" />
            </VBox>
        </VBox>
    </left>

    <!-- Main Content -->
    <center>
        <VBox styleClass="main-content">
            <!-- Header -->
            <HBox styleClass="site-header" alignment="CENTER_LEFT">
                <VBox HBox.hgrow="ALWAYS">
                    <Label text="Dashboard" styleClass="page-title" />
                    <Label fx:id="welcomeLabel" styleClass="page-subtitle" />
                </VBox>
                <HBox spacing="8">
                    <Button text="Refresh" styleClass="header-button" onAction="#refreshDashboard" />
                    <Button text="User Profile" styleClass="header-button" />
                </HBox>
            </HBox>
            
            <!-- Scrollable Content -->
            <ScrollPane styleClass="content-scroll" fitToWidth="true" VBox.vgrow="ALWAYS">
                <VBox styleClass="content-container" spacing="24">
                    <!-- Statistics Cards -->
                    <GridPane styleClass="stats-grid" hgap="16" vgap="16">
                        <!-- Card 1 -->
                        <VBox styleClass="stat-card" GridPane.rowIndex="0" GridPane.columnIndex="0">
                            <Label text="Total Books" styleClass="stat-label" />
                            <Label fx:id="totalBooksLabel" text="0" styleClass="stat-value" />
                            <Label fx:id="totalBooksChangeLabel" text="+0% from last month" styleClass="stat-change" />
                        </VBox>

                        <!-- Card 2 -->
                        <VBox styleClass="stat-card" GridPane.rowIndex="0" GridPane.columnIndex="1">
                            <Label text="Active Members" styleClass="stat-label" />
                            <Label fx:id="activeMembersLabel" text="0" styleClass="stat-value" />
                            <Label fx:id="activeMembersChangeLabel" text="+0% from last month" styleClass="stat-change" />
                        </VBox>

                        <!-- Card 3 -->
                        <VBox styleClass="stat-card" GridPane.rowIndex="0" GridPane.columnIndex="2">
                            <Label text="Active Borrowings" styleClass="stat-label" />
                            <Label fx:id="activeBorrowingsLabel" text="0" styleClass="stat-value" />
                            <Label fx:id="activeBorrowingsChangeLabel" text="+0% from last month" styleClass="stat-change" />
                        </VBox>

                        <!-- Card 4 -->
                        <VBox styleClass="stat-card" GridPane.rowIndex="0" GridPane.columnIndex="3">
                            <Label text="Overdue Books" styleClass="stat-label" />
                            <Label fx:id="overdueBooksLabel" text="0" styleClass="stat-value" />
                            <Label fx:id="overdueBooksChangeLabel" text="-0% from last month" styleClass="stat-change" />
                        </VBox>

                        <!-- Card 5 -->
                        <VBox styleClass="stat-card" GridPane.rowIndex="0" GridPane.columnIndex="4">
                            <Label text="Total Fines" styleClass="stat-label" />
                            <Label fx:id="totalFinesLabel" text="0.00 $" styleClass="stat-value" />
                            <Label fx:id="totalFinesChangeLabel" text="+0% from last month" styleClass="stat-change" />
                        </VBox>
                    </GridPane>
                    
                    <!-- Chart Section -->
                    <VBox styleClass="chart-section" spacing="16">
                        <Label text="Activity Overview" styleClass="section-title" />
                        
                        <!-- Chart Tabs for different views -->
                        <VBox spacing="8" styleClass="chart-container">
                                <LineChart fx:id="dailyActivityChart">
                                    <xAxis>
                                        <CategoryAxis fx:id="xAxisDaily" label="Date" />
                                    </xAxis>
                                    <yAxis>
                                        <NumberAxis fx:id="yAxisDaily" label="Number of Activities" />
                                    </yAxis>
                                </LineChart>
                        </VBox>

                        <HBox spacing="16">
                            <!-- Left Chart - Activity Types -->
                            <VBox styleClass="chart-section" HBox.hgrow="ALWAYS" spacing="8">
                                <Label text="Activities by Type" styleClass="section-title" />
                                <VBox spacing="8" styleClass="chart-container">
                                    <BarChart fx:id="activityTypeChart">
                                        <xAxis>
                                            <CategoryAxis fx:id="xAxisTypes" label="Activity Type" />
                                        </xAxis>
                                        <yAxis>
                                            <NumberAxis fx:id="yAxisTypes" label="Count" />
                                        </yAxis>
                                    </BarChart>
                                </VBox>
<!--                                <HBox spacing="8" alignment="CENTER">-->
<!--                                    <Label text="Most Common:" styleClass="chart-stat-label" />-->
<!--                                    <Label fx:id="mostCommonActivityLabel" text="-" styleClass="chart-stat-value" />-->
<!--                                </HBox>-->
                            </VBox>

                            <!-- Right Chart - User Activity -->
                            <VBox styleClass="chart-section" HBox.hgrow="ALWAYS" spacing="8">
                                <Label text="Most Active Users" styleClass="section-title" />
                                <VBox spacing="8" styleClass="chart-container">
                                    <BarChart fx:id="userActivityChart">
                                        <xAxis>
                                            <CategoryAxis fx:id="xAxisUsers" label="Username" />
                                        </xAxis>
                                        <yAxis>
                                            <NumberAxis fx:id="yAxisUsers" label="Activities Count" />
                                        </yAxis>
                                    </BarChart>
                                </VBox>
<!--                                <HBox spacing="8" alignment="CENTER">-->
<!--                                    <Label text="Top User:" styleClass="chart-stat-label" />-->
<!--                                    <Label fx:id="topUserLabel" text="-" styleClass="chart-stat-value" />-->
<!--                                </HBox>-->
                            </VBox>
                        </HBox>

                        <!-- Two more charts side by side (new additions) -->
<!--                        <HBox spacing="16" styleClass="bottom-charts-container">-->
<!--                            &lt;!&ndash; Left Chart - Fine Distribution &ndash;&gt;-->
<!--                            <VBox styleClass="chart-container" HBox.hgrow="ALWAYS" spacing="8">-->
<!--                                <Label text="Fine Distribution by Status" styleClass="chart-subtitle" />-->
<!--                                <PieChart fx:id="fineDistributionChart" legendVisible="true" />-->
<!--                                <HBox spacing="8" alignment="CENTER">-->
<!--                                    <Label text="Total Fines:" styleClass="chart-stat-label" />-->
<!--                                    <Label fx:id="totalFinesAmountLabel" text="$0.00" styleClass="chart-stat-value" />-->
<!--                                </HBox>-->
<!--                            </VBox>-->

<!--                            &lt;!&ndash; Right Chart - Borrowing Status &ndash;&gt;-->
<!--                            <VBox styleClass="chart-container" HBox.hgrow="ALWAYS" spacing="8">-->
<!--                                <Label text="Borrowing Status Overview" styleClass="chart-subtitle" />-->
<!--                                <BarChart fx:id="borrowingStatusChart">-->
<!--                                    <xAxis>-->
<!--                                        <CategoryAxis fx:id="xAxisBorrowingStatus" label="Status" />-->
<!--                                    </xAxis>-->
<!--                                    <yAxis>-->
<!--                                        <NumberAxis fx:id="yAxisBorrowingStatus" label="Count" />-->
<!--                                    </yAxis>-->
<!--                                </BarChart>-->
<!--                                <HBox spacing="8" alignment="CENTER">-->
<!--                                    <Label text="Overdue Rate:" styleClass="chart-stat-label" />-->
<!--                                    <Label fx:id="overdueRateLabel" text="0%" styleClass="chart-stat-value" />-->
<!--                                </HBox>-->
<!--                            </VBox>-->
<!--                        </HBox>-->
                        
                        <!-- Quick Stats under the charts -->
                        <GridPane hgap="16" vgap="8" styleClass="chart-stats">
                            <Label text="Total Activities (7 days):" GridPane.rowIndex="0" GridPane.columnIndex="0" 
                                   styleClass="chart-stat-label" />
                            <Label fx:id="totalActivitiesLabel" text="0" GridPane.rowIndex="0" GridPane.columnIndex="1" 
                                   styleClass="chart-stat-value" />
                            
                            <Label text="Average Daily:" GridPane.rowIndex="1" GridPane.columnIndex="0" 
                                   styleClass="chart-stat-label" />
                            <Label fx:id="avgDailyActivitiesLabel" text="0" GridPane.rowIndex="1" GridPane.columnIndex="1" 
                                   styleClass="chart-stat-value" />
                            
                            <Label text="Most Active Day:" GridPane.rowIndex="0" GridPane.columnIndex="2" 
                                   styleClass="chart-stat-label" />
                            <Label fx:id="mostActiveDayLabel" text="-" GridPane.rowIndex="0" GridPane.columnIndex="3" 
                                   styleClass="chart-stat-value" />
                            
                            <Label text="Most Active User:" GridPane.rowIndex="1" GridPane.columnIndex="2" 
                                   styleClass="chart-stat-label" />
                            <Label fx:id="mostActiveUserLabel" text="-" GridPane.rowIndex="1" GridPane.columnIndex="3" 
                                   styleClass="chart-stat-value" />
                        </GridPane>
                    </VBox>
                    
                    <!-- Data Tables -->
                    <VBox styleClass="table-section" spacing="24">
                        <!-- Recent Activity Table -->
                        <VBox spacing="12">
                            <Label text="Recent Activity" styleClass="section-title" />
                            <TableView fx:id="recentActivityTable" styleClass="data-table">
                                <columns>
                                    <TableColumn fx:id="userColumn" text="User" prefWidth="150" styleClass="table-column">
                                        <cellValueFactory>
                                            <PropertyValueFactory property="user.username" />
                                        </cellValueFactory>
                                    </TableColumn>
                                    <TableColumn fx:id="actionColumn" text="Action" prefWidth="150" styleClass="table-column">
                                        <cellValueFactory>
                                            <PropertyValueFactory property="action" />
                                        </cellValueFactory>
                                    </TableColumn>
                                    <TableColumn fx:id="descriptionColumn" text="Description" prefWidth="300" styleClass="table-column">
                                        <cellValueFactory>
                                            <PropertyValueFactory property="description" />
                                        </cellValueFactory>
                                    </TableColumn>
                                    <TableColumn fx:id="timestampColumn" text="Timestamp" prefWidth="200" styleClass="table-column">
                                        <cellValueFactory>
                                            <PropertyValueFactory property="timestamp" />
                                        </cellValueFactory>
                                    </TableColumn>
                                </columns>
                            </TableView>
                        </VBox>
                        
                        <!-- Recent Users Table -->
                        <VBox spacing="12">
                            <Label text="Recent Users" styleClass="section-title" />
                            <TableView fx:id="recentUsersTable" styleClass="data-table">
                                <columns>
                                    <TableColumn fx:id="usernameColumn" text="Username" prefWidth="200" styleClass="table-column">
                                        <cellValueFactory>
                                            <PropertyValueFactory property="username" />
                                        </cellValueFactory>
                                    </TableColumn>
                                    <TableColumn fx:id="emailColumn" text="Email" prefWidth="250" styleClass="table-column">
                                        <cellValueFactory>
                                            <PropertyValueFactory property="email" />
                                        </cellValueFactory>
                                    </TableColumn>
                                    <TableColumn fx:id="roleColumn" text="Role" prefWidth="150" styleClass="table-column">
                                        <cellValueFactory>
                                            <PropertyValueFactory property="role" />
                                        </cellValueFactory>
                                    </TableColumn>
                                    <TableColumn fx:id="joinedDateColumn" text="Joined Date" prefWidth="200" styleClass="table-column">
                                        <cellValueFactory>
                                            <PropertyValueFactory property="createdAt" />
                                        </cellValueFactory>
                                    </TableColumn>
                                </columns>
                            </TableView>
                        </VBox>
                    </VBox>
                </VBox>
            </ScrollPane>
        </VBox>
    </center>

</BorderPane>